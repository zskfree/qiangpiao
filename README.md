# 深圳大学体育场馆预约系统 Web版

## 🎯 项目概述

这是一个功能完善的深圳大学体育场馆自动预约系统，提供现代化的Web界面操作，支持多种运动项目的智能预约，具有实时监控、Cookie管理等特性。

## ✨ 主要特性

### 🌐 现代化Web界面

- **优雅设计**: 统一的渐变背景和圆角卡片设计
- **响应式布局**: 完美适配桌面和移动设备
- **实时监控**: 抢票进度实时更新，无需刷新页面
- **独立样式**: 无外部依赖，所有样式内置
- **直观导航**: 统一的页面导航和状态反馈

### 🤖 智能化预约特性

- **多项目支持**: 羽毛球、乒乓球、网球、篮球、排球、游泳、桌球
- **多校区支持**: 粤海校区、丽湖校区
- **智能时段选择**: 最多预约2个不同时间段
- **优先级策略**: 按配置的时段优先级智能选择
- **SSL连接优化**: 完美解决SSL握手失败问题

### 🛡️ 稳定性和易用性

- **完善异常处理**: 网络错误、Cookie失效、JSON解析错误全覆盖
- **智能重试机制**: 可配置重试次数和间隔
- **Cookie状态检查**: 实时检测和验证Cookie有效性
- **状态持久化**: 每次启动自动重置，确保干净状态
- **详细日志系统**: 文件和控制台双重日志记录

## 🚀 快速开始

### 一键启动Web服务

```bash
# 方案一：双击start.bat

# 方案二：启动Web界面
python start_web.py
```

浏览器会自动打开 <http://localhost:5000>

### 完成配置流程

1. **配置基本参数**
   - 访问"配置管理"页面
   - 选择校区、运动项目
   - 设置预约日期和时间段
   - 填写真实的学号和姓名

2. **更新Cookie**
   - 访问"Cookie管理"页面
   - 按照指南获取Cookie
   - 测试和更新Cookie

3. **开始智能预约**
   - 访问"智能抢票"页面
   - 点击"开始预约"按钮
   - 实时监控预约进度

## ⚙️ 配置说明

### 基础设置

| 参数 | 说明 | 可选值 |
|------|------|--------|
| 校区选择 | 目标校区 | 粤海校区、丽湖校区 |
| 运动项目 | 预约项目 | 羽毛球、乒乓球、网球等7种项目 |
| 预约日期 | 目标日期 | 格式：YYYY-MM-DD |
| 时间段 | 优先时段 | 最多选择5个，按优先级排序 |

### 用户信息（必填）

```
学号/工号: 你的真实学号
姓名: 你的真实姓名
```

**⚠️ 重要提醒**: 必须填写真实的学号和姓名，否则预约将失败。

### 高级设置

| 参数 | 说明 | 推荐值 |
|------|------|--------|
| 最大重试次数 | 查询重试上限 | 200 |
| 重试间隔 | 查询间隔时间(秒) | 1-2 |

## 🔑 Cookie管理指南

### 获取Cookie步骤

1. **登录深大门户**
   - 使用Chrome浏览器访问 <https://ehall.szu.edu.cn>
   - 输入账号密码登录

2. **进入预约系统**
   - 找到"体育场馆预约"应用
   - 点击进入预约界面

3. **提取Cookie**
   - 按 F12 打开开发者工具
   - 切换到 Network 标签
   - 刷新页面(F5)
   - 点击任意请求查看详情
   - 在 Request Headers 中找到 Cookie
   - 复制完整的Cookie值

4. **更新到系统**
   - 访问"Cookie管理"页面
   - 粘贴Cookie到输入框
   - 点击"测试Cookie"验证
   - 点击"更新Cookie"保存

### Cookie状态监控

Web界面会实时显示Cookie状态：

- ✅ **有效**: Cookie正常，可以开始预约
- ❌ **无效**: Cookie已过期，需要重新获取
- ⚠️ **异常**: 网络或格式问题，请检查后重试

## 📊 Web界面功能

### 首页 Dashboard

- 系统功能总览
- 当前配置状态
- 快速导航菜单
- 使用提示和帮助

### 配置管理

- 🏫 基础设置：校区、项目、日期
- ⏰ 时间段选择：优先级时段配置
- 👤 用户信息：学号姓名设置
- ⚙️ 高级设置：重试参数调整

### Cookie管理

- 📊 实时状态：当前Cookie有效性
- 🔑 更新功能：测试和更新Cookie
- 👁️ 详情查看：Cookie内容和字段解析
- 📖 获取指南：详细的获取步骤

### 智能抢票

- 🎮 控制台：一键启动/停止
- 📊 实时统计：运行时间、查询次数、成功数量
- 📋 状态监控：当前状态和实时日志
- 🏆 结果展示：预约成功记录

## 🎯 最佳使用策略

### 预约时机

- **提前启动**: 在预约开放前5-10分钟启动系统
- **稳定网络**: 确保网络连接稳定，避免频繁断线
- **避开高峰**: 选择网络较为畅通的时段

### 配置建议

- **时段配置**: 配置3-5个候选时段，提高成功率
- **重试设置**: 重试间隔设为1-2秒，避免过于频繁
- **Cookie维护**: 定期检查和更新Cookie状态

### 监控要点

- 关注Web界面的实时状态更新
- 注意Cookie有效性警告提示
- 及时查看预约成功通知
- 监控系统异常和错误信息

## 🔧 故障排除

### 常见问题及解决方案

**Q: Web服务启动失败**

```bash
# 检查Python环境
python --version

# 安装依赖
pip install flask requests

# 重新启动
python start_web.py
```

**Q: Cookie失效或无效**

- 访问Cookie管理页面
- 点击"重新检查"按钮
- 按照指南重新获取Cookie
- 确保Cookie格式正确完整

**Q: 端口5000被占用**

- 关闭其他占用端口的程序
- 等待几秒后重新启动
- 检查是否有其他实例在运行

**Q: 长时间无预约结果**

- 检查目标日期是否正确
- 确认预约时段是否已开放
- 验证Cookie是否仍然有效
- 检查网络连接稳定性

### 调试技巧

**Web界面调试**:

- Cookie管理页面查看详细状态
- 抢票页面观察实时日志
- 注意浏览器控制台错误信息

**命令行调试**:

```bash
# 启用调试模式
python qiangpiao.py --debug

# 查看运行日志
type qiangpiao.log  # Windows
cat qiangpiao.log   # Linux/Mac
```

## 📁 项目结构

```
深大体育场馆预约系统/
├── 🚀 启动文件
│   └── start_web.py          # Web服务启动脚本
├── 🌐 Web应用
│   ├── web_app.py            # Flask主应用
│   └── templates/            # HTML模板文件
│       ├── index.html        # 首页
│       ├── config.html       # 配置管理页面
│       ├── cookie.html       # Cookie管理页面
│       ├── booking.html      # 智能抢票页面
│       └── base.html         # 基础模板(已弃用)
├── 🔧 核心模块
│   ├── qiangpiao.py          # 主抢票逻辑
│   └── config.py             # 配置文件
├── 📁 静态资源 (已移除)
│   ├── static/style.css      # 样式文件(已弃用)
│   └── static/script.js      # 脚本文件(已弃用)
├── 📄 文档
│   └── README.md             # 项目说明文档
└── 📊 运行时文件
    └── qiangpiao.log         # 运行日志
```

**注**: 项目已完全移除Bootstrap依赖，所有页面使用独立的内联样式设计。

## 📈 运行示例

### 系统启动

```
🚀 正在启动...
🧹 清理历史文件...
🔄 重置模块状态...
📁 检查必要文件...
📡 启动Web服务器...
🌐 服务地址: http://localhost:5000
🌐 浏览器已打开
🌐 Web服务器启动成功！
```

### 预约成功示例

```
🎉 预约成功！场地：20:00-21:00 - 至快体育馆A1
📋 预约单号：YY202501010001

🎉 预约详情:
   📅 日期: 2025-01-02
   ⏰ 时间: 20:00-21:00
   🏟️ 场地: 至快体育馆羽毛球场A1
   📋 单号: YY202501010001
```

### Web界面状态

- **运行时间**: 00:15:32
- **查询次数**: 156
- **成功预约**: 2
- **当前状态**: ✅ 抢票完成！成功预约2个时间段

## ⚠️ 重要提醒

### 配置要求

1. **真实信息**: 必须使用真实的学号和姓名
2. **Cookie更新**: 定期检查和更新Cookie有效性
3. **合理日期**: 设置有效的预约日期
4. **网络稳定**: 确保网络连接稳定可靠

### 使用规范

1. **合规使用**: 严格遵守学校相关规定
2. **适度频率**: 合理设置重试间隔，避免过度请求
3. **隐私保护**: 妥善保管Cookie等敏感信息
4. **单实例运行**: 避免同时运行多个抢票实例

### 技术要求

- **Python版本**: 3.6 或更高版本
- **依赖库**: Flask、requests
- **浏览器**: 现代浏览器（Chrome推荐）
- **网络**: 稳定的互联网连接

## 🆘 获取帮助

### 快速诊断命令

```bash
# 启动Web界面
python start_web.py

# 直接运行抢票
python qiangpiao.py

# 调试模式
python qiangpiao.py --debug
```

### 自助解决步骤

1. **检查配置**: 确认所有必填信息已正确填写
2. **验证Cookie**: 使用Cookie管理页面检查状态
3. **查看日志**: 观察Web界面实时日志或文件日志
4. **网络检查**: 确认网络连接和深大门户可访问性

## 🎊 版本信息

- **当前版本**: v3.3 Web版
- **支持项目**: 7种运动项目
- **支持校区**: 2个校区
- **界面语言**: 中文
- **最后更新**: 2024年最新版

## 📄 许可与声明

本项目仅供学习交流使用，请严格遵守深圳大学相关规定，合理合规使用。

---

🏸 **祝您预约成功！** 享受现代化Web界面带来的便捷预约体验！
