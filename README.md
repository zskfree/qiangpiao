# 深圳大学体育场馆预约系统 🏸

一个功能完整的深圳大学体育场馆自动预约工具，支持Web界面操作和命令行运行。

## ✨ 功能特色

### 🎯 核心功能

- **自动预约** - 智能监控可用时段，自动完成预约
- **多时段支持** - 可同时预约2个不同时间段
- **场馆优先级** - 智能优选至快体育馆 > 至畅体育馆
- **实时监控** - 高频率检测场地开放状态
- **智能重试** - 网络异常自动重试，提高成功率

### 🌐 Web管理界面

- **配置管理** - 可视化配置预约参数
- **Cookie管理** - 一键更新和测试登录状态
- **自动获取Cookie** - 浏览器自动登录获取Cookie
- **实时监控** - 查看预约进度和状态
- **预约历史** - 查看成功预约记录

### 🏸 支持项目

- 羽毛球 🏸
- 篮球 🏀  
- 网球 🎾
- 排球 🏐
- 游泳 🏊
- 乒乓球 🏓
- 桌球 🎱

### 🏫 校区支持

- 粤海校区
- 丽湖校区

## 📋 系统要求

### 基础环境

- **Python 3.7+**
- **Chrome浏览器** (用于Cookie获取)
- **Windows/Linux/macOS**

### Python依赖

```
requests>=2.25.0
flask>=2.0.0
selenium>=4.0.0
urllib3>=1.26.0
```

## 🚀 快速开始

### 1. 环境准备

```bash
# 克隆项目
git clone <项目地址>
cd qiangpiao

# 安装依赖
pip install -r requirements.txt
```

### 2. 配置设置

编辑 `config.py` 文件：

```python
CONFIG = {
    "XQ": "2",                    # 校区：1=粤海, 2=丽湖
    "XMDM": "001",               # 项目：001=羽毛球
    "TARGET_DATE": "2025-05-27", # 预约日期
    "PREFERRED_TIMES": [         # 优先时段
        "20:00-21:00", 
        "21:00-22:00"
    ],
    "USER_INFO": {
        "YYRGH": "2300123999",   # 学号/工号
        "YYRXM": "张三"          # 姓名
    }
}
```

### 3. 获取Cookie

#### 方法一：Web界面自动获取 (推荐)

```bash
# 启动Web服务
python start_web.py

# 浏览器访问 http://localhost:5000
# 在Cookie管理页面输入账号密码自动获取
```

#### 方法二：手动获取

1. 浏览器登录 <https://ehall.szu.edu.cn>
2. 进入体育场馆预约系统
3. F12开发者工具 > Network > 复制Cookie
4. 更新到 `qiangpiao.py` 的 `raw_cookie` 变量

### 4. 开始预约

#### Web界面运行 (推荐)

```bash
python start_web.py
# 访问 http://localhost:5000 进行可视化操作
```

#### 命令行运行

```bash
python qiangpiao.py
```

## 📖 详细使用指南

### Web界面操作

#### 🏠 首页

- 查看当前配置概览
- 快速进入各功能模块
- 检查系统状态

#### ⚙️ 配置管理

- **基础设置**: 校区、项目、预约日期
- **时段选择**: 设置优先预约时间
- **用户信息**: 学号姓名配置
- **高级选项**: 重试次数、间隔设置

#### 🍪 Cookie管理

- **自动获取**: 输入账号密码自动登录获取
- **手动更新**: 粘贴Cookie字符串更新
- **状态检测**: 实时检查Cookie有效性
- **历史备份**: 自动备份历史Cookie

#### 🎯 抢票中心

- **一键启动**: 开始自动预约监控
- **实时状态**: 查看当前预约进度
- **成功记录**: 显示预约成功的时段
- **手动停止**: 随时停止预约进程

### 命令行工具

#### Cookie管理器

```bash
# 检查Cookie状态
python cookie_manager.py check

# 更新Cookie
python cookie_manager.py update

# 测试Cookie有效性
python cookie_manager.py test
```

#### 调试模式

```bash
# 启用详细日志
python qiangpiao.py --debug
```

## 🔧 高级配置

### 预约策略优化

```python
# 时段优先级设置 (按优先级排序)
"PREFERRED_TIMES": [
    "20:00-21:00",  # 最优先
    "21:00-22:00",  # 次优先
    "19:00-20:00"   # 备选
]

# 场馆优先级 (代码自动处理)
# 至快体育馆 > 至畅体育馆 > 其他场馆
```

### 网络设置优化

```python
CONFIG = {
    "REQUEST_TIMEOUT": 10,    # 请求超时(秒)
    "RETRY_INTERVAL": 1,     # 重试间隔(秒)
    "MAX_RETRY_TIMES": 200   # 最大重试次数
}
```

### SSL问题解决

项目内置SSL错误过滤机制，自动处理证书问题，无需手动配置。

## 🛠️ 故障排除

### 常见问题

#### ❌ Cookie失效

**现象**: 提示"需要重新登录"  
**解决**:

1. 使用Web界面自动获取新Cookie
2. 或运行 `python cookie_manager.py update`

#### ❌ 网络连接错误

**现象**: 请求超时或连接失败  
**解决**:

1. 检查网络连接
2. 尝试更换网络环境
3. 增加超时时间设置

#### ❌ 预约失败

**现象**: 找到可用时段但预约失败  
**解决**:

1. 检查用户信息是否正确
2. 确认目标日期设置合理
3. 验证Cookie是否有效

#### ❌ 浏览器启动失败

**现象**: Selenium无法启动Chrome  
**解决**:

1. 确保已安装Chrome浏览器
2. 更新Chrome到最新版本
3. 检查系统PATH环境变量

### 调试技巧

#### 启用详细日志

```bash
python qiangpiao.py --debug
```

#### 检查网络连接

```python
# 在Python中测试
import requests
resp = requests.get("https://ehall.szu.edu.cn", verify=False)
print(f"状态码: {resp.status_code}")
```

#### 验证配置文件

```bash
python -c "from config import CONFIG; print(CONFIG)"
```

## 📊 性能优化

### 提高成功率技巧

1. **合理设置重试间隔**: 1-3秒最佳
2. **选择网络稳定时段**: 避开网络高峰期
3. **多时段备选**: 设置多个可接受的时间段
4. **及时更新Cookie**: 定期检查登录状态

### 资源使用优化

- Web模式内存占用: ~50MB
- 命令行模式内存占用: ~20MB
- CPU使用率: 低 (<5%)
- 网络流量: 极少 (<1MB/小时)

## 🔒 安全说明

### 隐私保护

- 所有账号信息仅存储在本地
- 不收集或上传任何个人数据
- Cookie信息本地加密存储

### 使用建议

- 定期更新项目到最新版本
- 不要在公共环境保存账号信息
- 使用完毕后及时清理敏感信息

## 📝 更新日志

### v1.0.0 (2024-12-XX)

- ✨ 首次发布
- 🌐 Web管理界面
- 🤖 自动Cookie获取
- 🎯 智能预约策略
- 🔧 命令行工具集

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发环境设置

```bash
git clone <项目地址>
cd qiangpiao
pip install -r requirements.txt
```

### 代码规范

- 遵循PEP 8编码规范
- 添加适当的注释和文档
- 编写测试用例

## 📄 许可证

本项目仅供学习交流使用，请勿用于商业用途。

## ⚠️ 免责声明

- 本工具仅为方便学生预约体育场馆而开发
- 使用者应遵守学校相关规定和网络使用条款
- 开发者不承担因使用本工具而产生的任何责任
- 请合理使用，避免对服务器造成过大压力

---

**🎉 祝您预约成功！享受运动的快乐！** 🏸🏀🎾
